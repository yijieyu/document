## 文件

#### 参数文件

###### 什么是参数

###### 参数类型

- 动态参数

> 可以修改的参数， 范围有全局global/当前会话session，当前会话只作用于当前用户的修改，全局则作用于所有用户
一旦重启，修改的参数又会回到配置文件的初始值 

```mysql
set @@global.read_buffer_size = 1048576;
set @@session.read_buffer_size = 1048576;
```

- 静态参数

> 不可修改，只读权限

###### 日志文件

- 错误日志(error log)

> 记录mysql的启动、运行、关闭过程产生的错误信息以及一些警告信息或正确的信息

```mysql
# 查看错误日志文件位置
show variables  like 'log_error';
```
- 慢查询日志(slow query log)

> 慢查询日志可以定位可能存在问题的sql语句，从而进行sql语句层面的优化，
慢查询语句记录时间是通过参数long_query_time来记录，必须是大于long_query_time
```bash

# 查询慢日志
mysqldumpslow xxx.log

```

> 慢查询日志默认是文件，可以设置为table 则存储在表中

```mysql

# 查看
show variables  like  'log_output';

# 设置
set global log_output='TABLE';

```

- 二进制日志(binlog)

> 记录了对mysql数据库执行更改的所有操作，但是不包括select和show这类操作，因为这类操作对数据本身并没有修改。
然后操作并没有导致数据库发生变化，那么该操作可能也会写入二进制日志

>作用: 
>恢复： 某些数据的恢复需要二进制日志，例如，在一个数据库全备文件恢复后，用户可以通过二进制日志进行point-in-time的恢复 
>复制： 其原理和恢复类似，通过复制和执行二进制日志使一台远程mysql数据库（一般称为slave） 与一台mysql数据库（master）进行实时同步
>审计： 用户可以通过二进制日志中的信息来进行审计，判断是否有对数据库进行注入的攻击

```mysql

# log-bin=[name] 可以启动二进制日志
# 查看
show variables like 'datadir';

```

> 启动二进制日志对整个数据库性能有影响，不过很少。 用很少的影响换取复制与恢复是可以接受的


> 当使用事务的表存储引擎时，所有的未提交的二进制日志会被记录到一个缓存中去，
等该事务提交时直接将缓冲中的二进制日志写入二进制日志文件，该缓冲的大小有binlog_cache_size决定，
默认为32k。如果事务的大小超过缓存设置大小，则会创建新的临时文件中，所以这个不能太小，
缓冲大小是基于会话的，这个值也不能太大

```mysql

show variables like 'binlog_cache_size';

show global status like 'binlog_cache'

```

> 默认情况下，二进制日志并不是每次写的时候同步到磁盘（可以理解为缓冲写）。
因此，当数据库所在操作系统发生宕机时，可能会有一部分数据没有写入二进制日志文件中，这会给恢复和复制带来问题
设置sync_binlog为1（同步写入二进制文件），设置innodb_support_xa=1,可取保二进制和innodb数据文件的同步。
可确保在事务发出commit动作之前，同步立即写入磁盘并成功，但提交并没有发生时宕机了，在mysql数据库下次启动时
由于commit操作并没有发生，这个事务会被会滚掉，但二进制文件已经记录该事务信息，不能被会滚，则用到innodb_support_xa参数


- 查询日志(log)

> 记录所有对mysql数据库请求的信息，无论这些请求是否得到了正确的执行，默认文件名为：主机名.log



###### Innodb存储引擎文件

- 重做日志文件

> 默认情况下，innodb存储引擎的数据目录下会有两个名为ib_logfile0和ib_logfile1文件 重做日志文件
它们记录Innodb存储引擎的事务日志
当实例或介质失败时，可以通过重做日志恢复到事故前的时刻，可以保证数据的完整性
为了保证事务的ACID中的永久性，必须将innodb_flush_at_trx_commit 设置为1，也就是每当有事务提交时，都必须确保事务都已经写入重做日志文件中

> 重做日志和二进制区别
1、二进制日志会记录所有与mysql的数据库相关的日志记录，包括其他存储引擎，Innodb存储引擎文件只记录有关该引擎本身的事务日志
2、记录的内容不同，二进制记录都是关于一个事务的具体操作内容SQL语句，日志都是逻辑日志。重组日志记录的是关于每个页的更改的物理情况
3、写入时间不同，二进制日志文件仅在事务提交前进行提交，即只写磁盘一次，不论这时该事务多大。
而重做日志在事务进行的过程中，却不断有重做日志条目被写入到重做日志文件中，重做日志是顺序写

- LSN 日志序列号
```text
biaoshi 
```
